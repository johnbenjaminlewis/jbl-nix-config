#!/usr/bin/env bash
set -eo pipefail

ROOT_DIR="$( cd -- "$( dirname -- "${BASH_SOURCE[0]}" )" &> /dev/null && pwd )/.."
source "$ROOT_DIR/bin/_shared.sh"

if [ ! -f "$HOST_FLAKE_DIR/flake.nix" ]; then
    echo "Error: You have not written a flake for hostname='$HOSTNAME'."
    echo "Please create a flake in '$HOST_FLAKE_DIR'"
    exit 1
fi

exec darwin-rebuild switch --flake "$HOST_FLAKE_DIR"
